<!DOCTYPE html>
<html>

<head>
	<title>Gainz & Grains</title>
	<!-- CSS Reset -->
	<link rel="stylesheet" type="text/css" href="assets/css/reset.css">

	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

	<!-- Bootswatch 'United' Theme -->
	<link rel="stylesheet" type="text/css" href="assets/css/unitedBootstrapTheme.css">

	<!-- Google Fonts -->
	<!-- <link href="https://fonts.googleapis.com/css?family=Asap:400,700|Flamenco|Lato" rel="stylesheet"> -->

	<!-- Style Sheet -->
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">

	<meta charset="UTF-8">
</head>

<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="hamburger navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
				<a class="navbar-brand pageHeader" href="#">Gainz & Grains</a>
			</div>

			<!-- <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
					<li><a href="#">Link</a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Action</a></li>
							<li><a href="#">Another action</a></li>
							<li><a href="#">Something else here</a></li>
							<li class="divider"></li>
							<li><a href="#">Separated link</a></li>
							<li class="divider"></li>
							<li><a href="#">One more separated link</a></li>
						</ul>
					</li>
				</ul>
				<form class="navbar-form navbar-left" role="search">
					<div class="form-group">
						<input type="text" class="form-control" placeholder="Search">
					</div>
					<button type="submit" class="btn btn-default">Submit</button>
				</form>
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#">Link</a></li>
				</ul>
			</div> -->
		</div>
	</nav>

	<div class="myGym">
		<div class="form-group">
			<label id="myGymHeader" for="pac-input">My Gym:</label>
			<br>
			<input id="pac-input" class="controls form-control" type="text" placeholder="Search for a Gym">
			<!-- <input class="form-control" id="employee-name-input" type="text"> -->
		</div>
	</div>


	<div class="container" id="mapDiv1">
		<div class="row" id="mapDiv2">
			<div class="col-md-6" id="mapDiv3">
				<div id="map"></div>
			</div>
			<div class="col-md-6" id="results2">
				<div class="resultsContainer" id="results3">
				</div>
			</div>
		</div>
	</div>



	<!-- Results Container (Holds 5 Results) -->

	<!-- <div class="resultsContainer container">
		<div class="row">
			<div class="col-md-12 nearbyRelief">
				<header class="nearbyReliefHeader"><strong>Nearby Relief</strong></header>
				<hr>
			</div>
		</div>

		<br>

		<div class="results">
			<div class="row resultRow1">
				<div class="col-md-12">
					<p class="breweryName"><strong>1. Pauls Brewery</strong></p>
					<hr>
				</div>
			</div>

			Results Row #2
			<div class="row resultRow2">
				<div class="col-md-12">
					<p class="breweryName">2. Pauls Brewery</p>
					<hr>
				</div>
			</div>

			Results Row #3
			<div class="row resultRow3">
				<div class="col-md-12">
					<p class="breweryName">3. Pauls Brewery</p>
					<hr>
				</div>
			</div>

			Results Row #4
			<div class="row resultRow4">
				<div class="col-md-12">
					<p class="breweryName">4. Pauls Brewery</p>
					<hr>
				</div>
			</div>

			Results Row #5
			<div class="row resultRow5">
				<div class="col-md-12">
					<p class="breweryName">5. Pauls Brewery</p>
					<hr>
				</div>
			</div>
		</div>
	</div> -->


	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCls9uUYJ4bnkQM3T704Qsc9-bAyjIqL88&libraries=places&callback=initMap" async defer></script>
	<script type="text/javascript" src="javascript/app.js"></script>

	<script type="text/javascript">
		var map;
		var infowindow;
		var resultsArray = [];
		var userGym = {
			lat: 30.2672,
			lng: -97.7431
		};

		function displayMap() {
			document.getElementById('map').style.display = "block";
			initMap();
		}

		function initMap() {
			userGym = {
				lat: userGym.lat,
				lng: userGym.lng
			}; //What we replace with what we type into the search bar

			map = new google.maps.Map(document.getElementById('map'), {
				center: userGym,
				zoom: 15
			});


			// Create the search box and link it to the UI element.
			var input = document.getElementById('pac-input');
			var searchBox = new google.maps.places.SearchBox(input);
			// map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);



			// Bias the SearchBox results towards current map's viewport.
			// map.addListener('bounds_changed', function() {
			//   searchBox.setBounds(map.getBounds());
			// });

			map.setCenter(userGym);
			// $("#map").hide();


			// Listen for the event fired when the user selects a prediction and retrieve
			// more details for that place.
			searchBox.addListener('places_changed', function() {

				// var mapLoad = document.getElementById('map');
				displayMap();

				var places = searchBox.getPlaces();

				var markers = [];
				infowindow = new google.maps.InfoWindow();
				var service = new google.maps.places.PlacesService(map);

				var newLat = places[0].geometry.viewport.f.b;
				var newLong = places[0].geometry.viewport.b.b;
				userGym = {
					lat: newLat,
					lng: newLong
				};

				service.nearbySearch({
					location: userGym,
					radius: 1610,
					type: ['bar']
				}, callback);


				if (places.length == 0) {
					return;
				}

				// Clear out the old markers.
				markers.forEach(function(marker) {
					marker.setMap(null);
				});
				markers = [];

				// For each place, get the icon, name and location.
				var bounds = new google.maps.LatLngBounds();
				places.forEach(function(place) {
					if (!place.geometry) {
						console.log("Returned place contains no geometry");
						return;
					}

					var icon = {
						url: place.icon,
						size: new google.maps.Size(71, 71),
						origin: new google.maps.Point(0, 0),
						anchor: new google.maps.Point(17, 34),
						scaledSize: new google.maps.Size(25, 25)
					};

					// Create a marker for each place.
					markers.push(new google.maps.Marker({
						map: map,
						icon: icon,
						title: place.name,
						position: place.geometry.location

					}));


					if (place.geometry.viewport) {
						// Only geocodes have viewport.
						bounds.union(place.geometry.viewport);
					} else {
						bounds.extend(place.geometry.location);
					}
				});
				map.fitBounds(bounds);
			});

		}

		function callback(results, status) {
			if (status === google.maps.places.PlacesServiceStatus.OK) {
				for (var i = 0; i < results.length; i++) {
					createMarker(results[i]);
					resultsArray.push(results[i]);
				}
			}
			createResultItems();
		}



		function createMarker(place) {
			var placeLoc = place.geometry.location;
			var marker = new google.maps.Marker({
				map: map,
				position: place.geometry.location
			});

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.setContent(place.name);
				infowindow.open(map, this);
			});
		}

		function createResultItems() {

			console.log(resultsArray);

			for (var i = 0; i < resultsArray.length; i++) {

				var name = $("<div>").append(resultsArray[i].name).addClass("resultName");
				var rating = $("<div>").append("Rating: " + resultsArray[i].rating + " / 5").addClass("resultRating");
				var vicinity = $("<div>").append(resultsArray[i].vicinity).addClass("resultVicinity");
				var priceLevel = $("<div>").append("Price: " + resultsArray[i].price_level).addClass("resultPrice");
				var hr = $("<hr>").addClass("resultHR");

				var newDiv = $("<div>");



				newDiv.append(name);
				newDiv.append(vicinity);
				newDiv.append(rating);
				// newDiv.append(priceLevel);
				newDiv.append(hr);

				$(".resultsContainer").append(newDiv);

			}
		}
	</script>

	<!-- Firebase Reference -->
	<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>

</body>

</html>
